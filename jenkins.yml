---
- name: Add jenkins apt-key
  #apt_key: keyserver=keyserver.ubuntu.com id=10AF40FE
  apt_key: keyserver=keyserver.ubuntu.com id=9B7D32F2D50582E6
- name: Add Jenkins apt repo 
  apt_repository: repo='deb http://pkg.jenkins-ci.org/debian-stable binary/' state=present
#- name: Add jenkins apt-key
#   apt_key: data="{{ lookup('file', 'jenkins-ci.org.key') }}" state=present
- name: Update apt
  apt:  update_cache=yes #cache_valid_time=3600
- name: Install jenkins apt package
  apt:  name=jenkins state=present
- name: Copy download script to machine
  copy: src=download-plugins.sh dest=/tmp/download-plugins.sh owner=vagrant group=vagrant mode=0744
- name: Copy plugins list to machine
  copy: src=plugins.txt dest=/tmp/plugins.txt 
- name: Download Jenkins plugins
  command: /tmp/download-plugins.sh /tmp/plugins.txt 
  changed_when: false
- service: name=jenkins state=restarted
